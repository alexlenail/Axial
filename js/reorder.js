(function(a){(function(a){science={version:"1.9.1"},science.ascending=function(a,b){return a-b},science.EULER=.5772156649015329,science.expm1=function(a){return a<1e-5&&a>-0.00001?a+.5*a*a:Math.exp(a)-1},science.functor=function(a){return typeof a=="function"?a:function(){return a}},science.hypot=function(a,b){a=Math.abs(a),b=Math.abs(b);var c,d;a>b?(c=a,d=b):(c=b,d=a);var e=d/c;return c*Math.sqrt(1+e*e)},science.quadratic=function(){function b(b,c,d){var e=c*c-4*b*d;return e>0?(e=Math.sqrt(e)/(2*b),a?[{r:-c-e,i:0},{r:-c+e,i:0}]:[-c-e,-c+e]):e===0?(e=-c/(2*b),a?[{r:e,i:0}]:[e]):a?(e=Math.sqrt(-e)/(2*b),[{r:-c,i:-e},{r:-c,i:e}]):[]}var a=!1;return b.complex=function(c){return arguments.length?(a=c,b):a},b},science.zeroes=function(a){var b=-1,c=[];if(arguments.length===1)while(++b<a)c[b]=0;else while(++b<a)c[b]=science.zeroes.apply(this,Array.prototype.slice.call(arguments,1));return c}})(this),function(a){function b(a,b,c){var d=c.length;for(var e=0;e<d;e++)a[e]=c[d-1][e];for(var f=d-1;f>0;f--){var g=0,h=0;for(var i=0;i<f;i++)g+=Math.abs(a[i]);if(g===0){b[f]=a[f-1];for(var e=0;e<f;e++)a[e]=c[f-1][e],c[f][e]=0,c[e][f]=0}else{for(var i=0;i<f;i++)a[i]/=g,h+=a[i]*a[i];var j=a[f-1],k=Math.sqrt(h);j>0&&(k=-k),b[f]=g*k,h-=j*k,a[f-1]=j-k;for(var e=0;e<f;e++)b[e]=0;for(var e=0;e<f;e++){j=a[e],c[e][f]=j,k=b[e]+c[e][e]*j;for(var i=e+1;i<=f-1;i++)k+=c[i][e]*a[i],b[i]+=c[i][e]*j;b[e]=k}j=0;for(var e=0;e<f;e++)b[e]/=h,j+=b[e]*a[e];var l=j/(h+h);for(var e=0;e<f;e++)b[e]-=l*a[e];for(var e=0;e<f;e++){j=a[e],k=b[e];for(var i=e;i<=f-1;i++)c[i][e]-=j*b[i]+k*a[i];a[e]=c[f-1][e],c[f][e]=0}}a[f]=h}for(var f=0;f<d-1;f++){c[d-1][f]=c[f][f],c[f][f]=1;var h=a[f+1];if(h!=0){for(var i=0;i<=f;i++)a[i]=c[i][f+1]/h;for(var e=0;e<=f;e++){var k=0;for(var i=0;i<=f;i++)k+=c[i][f+1]*c[i][e];for(var i=0;i<=f;i++)c[i][e]-=k*a[i]}}for(var i=0;i<=f;i++)c[i][f+1]=0}for(var e=0;e<d;e++)a[e]=c[d-1][e],c[d-1][e]=0;c[d-1][d-1]=1,b[0]=0}function c(a,b,c){var d=c.length;for(var e=1;e<d;e++)b[e-1]=b[e];b[d-1]=0;var f=0,g=0,h=1e-12;for(var i=0;i<d;i++){g=Math.max(g,Math.abs(a[i])+Math.abs(b[i]));var j=i;while(j<d){if(Math.abs(b[j])<=h*g)break;j++}if(j>i){var k=0;do{k++;var l=a[i],m=(a[i+1]-l)/(2*b[i]),n=science.hypot(m,1);m<0&&(n=-n),a[i]=b[i]/(m+n),a[i+1]=b[i]*(m+n);var o=a[i+1],p=l-a[i];for(var e=i+2;e<d;e++)a[e]-=p;f+=p,m=a[j];var q=1,r=q,s=q,t=b[i+1],u=0,v=0;for(var e=j-1;e>=i;e--){s=r,r=q,v=u,l=q*b[e],p=q*m,n=science.hypot(m,b[e]),b[e+1]=u*n,u=b[e]/n,q=m/n,m=q*a[e]-u*l,a[e+1]=p+u*(q*l+u*a[e]);for(var w=0;w<d;w++)p=c[w][e+1],c[w][e+1]=u*c[w][e]+q*p,c[w][e]=q*c[w][e]-u*p}m=-u*v*s*t*b[i]/o,b[i]=u*m,a[i]=q*m}while(Math.abs(b[i])>h*g)}a[i]=a[i]+f,b[i]=0}for(var e=0;e<d-1;e++){var w=e,m=a[e];for(var x=e+1;x<d;x++)a[x]<m&&(w=x,m=a[x]);if(w!=e){a[w]=a[e],a[e]=m;for(var x=0;x<d;x++)m=c[x][e],c[x][e]=c[x][w],c[x][w]=m}}}function d(a,b){var c=a.length,d=[],e=0,f=c-1;for(var g=e+1;g<f;g++){var h=0;for(var i=g;i<=f;i++)h+=Math.abs(a[i][g-1]);if(h!==0){var j=0;for(var i=f;i>=g;i--)d[i]=a[i][g-1]/h,j+=d[i]*d[i];var k=Math.sqrt(j);d[g]>0&&(k=-k),j-=d[g]*k,d[g]=d[g]-k;for(var l=g;l<c;l++){var m=0;for(var i=f;i>=g;i--)m+=d[i]*a[i][l];m/=j;for(var i=g;i<=f;i++)a[i][l]-=m*d[i]}for(var i=0;i<=f;i++){var m=0;for(var l=f;l>=g;l--)m+=d[l]*a[i][l];m/=j;for(var l=g;l<=f;l++)a[i][l]-=m*d[l]}d[g]=h*d[g],a[g][g-1]=h*k}}for(var i=0;i<c;i++)for(var l=0;l<c;l++)b[i][l]=i===l?1:0;for(var g=f-1;g>=e+1;g--)if(a[g][g-1]!==0){for(var i=g+1;i<=f;i++)d[i]=a[i][g-1];for(var l=g;l<=f;l++){var k=0;for(var i=g;i<=f;i++)k+=d[i]*b[i][l];k=k/d[g]/a[g][g-1];for(var i=g;i<=f;i++)b[i][l]+=k*d[i]}}}function e(a,b,c,d){var e=c.length,g=e-1,h=0,i=e-1,j=1e-12,k=0,l=0,m=0,n=0,o=0,p=0,q,r,s,t,u=0;for(var v=0;v<e;v++){if(v<h||v>i)a[v]=c[v][v],b[v]=0;for(var w=Math.max(v-1,0);w<e;w++)u+=Math.abs(c[v][w])}var x=0;while(g>=h){var y=g;while(y>h){o=Math.abs(c[y-1][y-1])+Math.abs(c[y][y]),o===0&&(o=u);if(Math.abs(c[y][y-1])<j*o)break;y--}if(y===g)c[g][g]=c[g][g]+k,a[g]=c[g][g],b[g]=0,g--,x=0;else if(y===g-1){r=c[g][g-1]*c[g-1][g],l=(c[g-1][g-1]-c[g][g])/2,m=l*l+r,p=Math.sqrt(Math.abs(m)),c[g][g]=c[g][g]+k,c[g-1][g-1]=c[g-1][g-1]+k,s=c[g][g];if(m>=0){p=l+(l>=0?p:-p),a[g-1]=s+p,a[g]=a[g-1],p!==0&&(a[g]=s-r/p),b[g-1]=0,b[g]=0,s=c[g][g-1],o=Math.abs(s)+Math.abs(p),l=s/o,m=p/o,n=Math.sqrt(l*l+m*m),l/=n,m/=n;for(var w=g-1;w<e;w++)p=c[g-1][w],c[g-1][w]=m*p+l*c[g][w],c[g][w]=m*c[g][w]-l*p;for(var v=0;v<=g;v++)p=c[v][g-1],c[v][g-1]=m*p+l*c[v][g],c[v][g]=m*c[v][g]-l*p;for(var v=h;v<=i;v++)p=d[v][g-1],d[v][g-1]=m*p+l*d[v][g],d[v][g]=m*d[v][g]-l*p}else a[g-1]=s+l,a[g]=s+l,b[g-1]=p,b[g]=-p;g-=2,x=0}else{s=c[g][g],t=0,r=0,y<g&&(t=c[g-1][g-1],r=c[g][g-1]*c[g-1][g]);if(x==10){k+=s;for(var v=h;v<=g;v++)c[v][v]-=s;o=Math.abs(c[g][g-1])+Math.abs(c[g-1][g-2]),s=t=.75*o,r=-0.4375*o*o}if(x==30){o=(t-s)/2,o=o*o+r;if(o>0){o=Math.sqrt(o),t<s&&(o=-o),o=s-r/((t-s)/2+o);for(var v=h;v<=g;v++)c[v][v]-=o;k+=o,s=t=r=.964}}x++;var z=g-2;while(z>=y){p=c[z][z],n=s-p,o=t-p,l=(n*o-r)/c[z+1][z]+c[z][z+1],m=c[z+1][z+1]-p-n-o,n=c[z+2][z+1],o=Math.abs(l)+Math.abs(m)+Math.abs(n),l/=o,m/=o,n/=o;if(z==y)break;if(Math.abs(c[z][z-1])*(Math.abs(m)+Math.abs(n))<j*Math.abs(l)*(Math.abs(c[z-1][z-1])+Math.abs(p)+Math.abs(c[z+1][z+1])))break;z--}for(var v=z+2;v<=g;v++)c[v][v-2]=0,v>z+2&&(c[v][v-3]=0);for(var A=z;A<=g-1;A++){var B=A!=g-1;A!=z&&(l=c[A][A-1],m=c[A+1][A-1],n=B?c[A+2][A-1]:0,s=Math.abs(l)+Math.abs(m)+Math.abs(n),s!=0&&(l/=s,m/=s,n/=s));if(s==0)break;o=Math.sqrt(l*l+m*m+n*n),l<0&&(o=-o);if(o!=0){A!=z?c[A][A-1]=-o*s:y!=z&&(c[A][A-1]=-c[A][A-1]),l+=o,s=l/o,t=m/o,p=n/o,m/=l,n/=l;for(var w=A;w<e;w++)l=c[A][w]+m*c[A+1][w],B&&(l+=n*c[A+2][w],c[A+2][w]=c[A+2][w]-l*p),c[A][w]=c[A][w]-l*s,c[A+1][w]=c[A+1][w]-l*t;for(var v=0;v<=Math.min(g,A+3);v++)l=s*c[v][A]+t*c[v][A+1],B&&(l+=p*c[v][A+2],c[v][A+2]=c[v][A+2]-l*n),c[v][A]=c[v][A]-l,c[v][A+1]=c[v][A+1]-l*m;for(var v=h;v<=i;v++)l=s*d[v][A]+t*d[v][A+1],B&&(l+=p*d[v][A+2],d[v][A+2]=d[v][A+2]-l*n),d[v][A]=d[v][A]-l,d[v][A+1]=d[v][A+1]-l*m}}}}if(u==0)return;for(g=e-1;g>=0;g--){l=a[g],m=b[g];if(m==0){var y=g;c[g][g]=1;for(var v=g-1;v>=0;v--){r=c[v][v]-l,n=0;for(var w=y;w<=g;w++)n+=c[v][w]*c[w][g];if(b[v]<0)p=r,o=n;else{y=v,b[v]===0?c[v][g]=-n/(r!==0?r:j*u):(s=c[v][v+1],t=c[v+1][v],m=(a[v]-l)*(a[v]-l)+b[v]*b[v],q=(s*o-p*n)/m,c[v][g]=q,Math.abs(s)>Math.abs(p)?c[v+1][g]=(-n-r*q)/s:c[v+1][g]=(-o-t*q)/p),q=Math.abs(c[v][g]);if(j*q*q>1)for(var w=v;w<=g;w++)c[w][g]=c[w][g]/q}}}else if(m<0){var y=g-1;if(Math.abs(c[g][g-1])>Math.abs(c[g-1][g]))c[g-1][g-1]=m/c[g][g-1],c[g-1][g]=-(c[g][g]-l)/c[g][g-1];else{var C=f(0,-c[g-1][g],c[g-1][g-1]-l,m);c[g-1][g-1]=C[0],c[g-1][g]=C[1]}c[g][g-1]=0,c[g][g]=1;for(var v=g-2;v>=0;v--){var D=0,E=0,F,G;for(var w=y;w<=g;w++)D+=c[v][w]*c[w][g-1],E+=c[v][w]*c[w][g];r=c[v][v]-l;if(b[v]<0)p=r,n=D,o=E;else{y=v;if(b[v]==0){var C=f(-D,-E,r,m);c[v][g-1]=C[0],c[v][g]=C[1]}else{s=c[v][v+1],t=c[v+1][v],F=(a[v]-l)*(a[v]-l)+b[v]*b[v]-m*m,G=(a[v]-l)*2*m,F==0&G==0&&(F=j*u*(Math.abs(r)+Math.abs(m)+Math.abs(s)+Math.abs(t)+Math.abs(p)));var C=f(s*n-p*D+m*E,s*o-p*E-m*D,F,G);c[v][g-1]=C[0],c[v][g]=C[1];if(Math.abs(s)>Math.abs(p)+Math.abs(m))c[v+1][g-1]=(-D-r*c[v][g-1]+m*c[v][g])/s,c[v+1][g]=(-E-r*c[v][g]-m*c[v][g-1])/s;else{var C=f(-n-t*c[v][g-1],-o-t*c[v][g],p,m);c[v+1][g-1]=C[0],c[v+1][g]=C[1]}}q=Math.max(Math.abs(c[v][g-1]),Math.abs(c[v][g]));if(j*q*q>1)for(var w=v;w<=g;w++)c[w][g-1]=c[w][g-1]/q,c[w][g]=c[w][g]/q}}}}for(var v=0;v<e;v++)if(v<h||v>i)for(var w=v;w<e;w++)d[v][w]=c[v][w];for(var w=e-1;w>=h;w--)for(var v=h;v<=i;v++){p=0;for(var A=h;A<=Math.min(w,i);A++)p+=d[v][A]*c[A][w];d[v][w]=p}}function f(a,b,c,d){if(Math.abs(c)>Math.abs(d)){var e=d/c,f=c+e*d;return[(a+e*b)/f,(b-e*a)/f]}var e=c/d,f=d+e*c;return[(e*a+b)/f,(e*b-a)/f]}science.lin={},science.lin.decompose=function(){function a(a){var f=a.length,g=[],h=[],i=[];for(var j=0;j<f;j++)g[j]=[],h[j]=[],i[j]=[];var k=!0;for(var l=0;l<f;l++)for(var j=0;j<f;j++)if(a[j][l]!==a[l][j]){k=!1;break}if(k){for(var j=0;j<f;j++)g[j]=a[j].slice();b(h,i,g),c(h,i,g)}else{var m=[];for(var j=0;j<f;j++)m[j]=a[j].slice();d(m,g),e(h,i,m,g)}var n=[];for(var j=0;j<f;j++){var o=n[j]=[];for(var l=0;l<f;l++)o[l]=j===l?h[j]:0;n[j][i[j]>0?j+1:j-1]=i[j]}return{D:n,V:g}}return a},science.lin.cross=function(a,b){return[a[1]*b[2]-a[2]*b[1],a[2]*b[0]-a[0]*b[2],a[0]*b[1]-a[1]*b[0]]},science.lin.dot=function(a,b){var c=0,d=-1,e=Math.min(a.length,b.length);while(++d<e)c+=a[d]*b[d];return c},science.lin.length=function(a){return Math.sqrt(science.lin.dot(a,a))},science.lin.normalize=function(a){var b=science.lin.length(a);return a.map(function(a){return a/b})},science.lin.determinant=function(a){var b=a[0].concat(a[1]).concat(a[2]).concat(a[3]);return b[12]*b[9]*b[6]*b[3]-b[8]*b[13]*b[6]*b[3]-b[12]*b[5]*b[10]*b[3]+b[4]*b[13]*b[10]*b[3]+b[8]*b[5]*b[14]*b[3]-b[4]*b[9]*b[14]*b[3]-b[12]*b[9]*b[2]*b[7]+b[8]*b[13]*b[2]*b[7]+b[12]*b[1]*b[10]*b[7]-b[0]*b[13]*b[10]*b[7]-b[8]*b[1]*b[14]*b[7]+b[0]*b[9]*b[14]*b[7]+b[12]*b[5]*b[2]*b[11]-b[4]*b[13]*b[2]*b[11]-b[12]*b[1]*b[6]*b[11]+b[0]*b[13]*b[6]*b[11]+b[4]*b[1]*b[14]*b[11]-b[0]*b[5]*b[14]*b[11]-b[8]*b[5]*b[2]*b[15]+b[4]*b[9]*b[2]*b[15]+b[8]*b[1]*b[6]*b[15]-b[0]*b[9]*b[6]*b[15]-b[4]*b[1]*b[10]*b[15]+b[0]*b[5]*b[10]*b[15]},science.lin.gaussjordan=function(a,b){b||(b=1e-10);var c=a.length,d=a[0].length,e=-1,f,g;while(++e<c){var h=e;f=e;while(++f<c)Math.abs(a[f][e])>Math.abs(a[h][e])&&(h=f);var i=a[e];a[e]=a[h],a[h]=i;if(Math.abs(a[e][e])<=b)return!1;f=e;while(++f<c){var j=a[f][e]/a[e][e];g=e-1;while(++g<d)a[f][g]-=a[e][g]*j}}e=c;while(--e>=0){var j=a[e][e];f=-1;while(++f<e){g=d;while(--g>=e)a[f][g]-=a[e][g]*a[f][e]/j}a[e][e]/=j,g=c-1;while(++g<d)a[e][g]/=j}return!0},science.lin.inverse=function(a){var b=a.length,c=-1;if(b!==a[0].length)return;a=a.map(function(a,c){var d=new Array(b),e=-1;while(++e<b)d[e]=c===e?1:0;return a.concat(d)}),science.lin.gaussjordan(a);while(++c<b)a[c]=a[c].slice(b);return a},science.lin.multiply=function(a,b){var c=a.length,d=b[0].length,e=b.length,f=-1,g,h;if(e!==a[0].length)throw{error:"columns(a) != rows(b); "+a[0].length+" != "+e};var i=new Array(c);while(++f<c){i[f]=new Array(d),g=-1;while(++g<d){var j=0;h=-1;while(++h<e)j+=a[f][h]*b[h][g];i[f][g]=j}}return i},science.lin.transpose=function(a){var b=a.length,c=a[0].length,d=-1,e,f=new Array(c);while(++d<c){f[d]=new Array(b),e=-1;while(++e<b)f[d][e]=a[e][d]}return f},science.lin.tridag=function(a,b,c,d,e,f){var g,h;for(g=1;g<f;g++)h=a[g]/b[g-1],b[g]-=h*c[g-1],d[g]-=h*d[g-1];e[f-1]=d[f-1]/b[f-1];for(g=f-2;g>=0;g--)e[g]=(d[g]-c[g]*e[g+1])/b[g]}}(this),function(a){function b(a,b){if(!a||!b||a.length!==b.length)return!1;var c=a.length,d=-1;while(++d<c)if(a[d]!==b[d])return!1;return!0}function c(a,c){var d=c.length;if(a>d)return null;var e=[],f=[],g={},h=0,i=0,j,k,l;while(i<a){if(h===d)return null;var m=Math.floor(Math.random()*d);if(m in g)continue;g[m]=1,h++,k=c[m],l=!0;for(j=0;j<i;j++)if(b(k,e[j])){l=!1;break}l&&(e[i]=k,f[i]=m,i++)}return e}function d(a,b,c,d){var e=[],f=a+c,g=b.length,h=-1;while(++h<g)e[h]=(a*b[h]+c*d[h])/f;return e}function e(a){var b=a.length,c=-1;while(++c<b)if(!isFinite(a[c]))return!1;return!0}function f(a){var b=a.length,c=0;while(++c<b)if(a[c-1]>=a[c])return!1;return!0}function g(a){return(a=1-a*a*a)*a*a}function h(a,b,c,d){var e=d[0],f=d[1],g=i(b,f);if(g<a.length&&a[g]-a[c]<a[c]-a[e]){var h=i(b,e);d[0]=h,d[1]=g}}function i(a,b){var c=b+1;while(c<a.length&&a[c]===0)c++;return c}science.stats={},science.stats.bandwidth={nrd0:function(a){var b=Math.sqrt(science.stats.variance(a));return(lo=Math.min(b,science.stats.iqr(a)/1.34))||(lo=b)||(lo=Math.abs(a[1]))||(lo=1),.9*lo*Math.pow(a.length,-0.2)},nrd:function(a){var b=science.stats.iqr(a)/1.34;return 1.06*Math.min(Math.sqrt(science.stats.variance(a)),b)*Math.pow(a.length,-0.2)}},science.stats.distance={euclidean:function(a,b){var c=a.length,d=-1,e=0,f;while(++d<c)f=a[d]-b[d],e+=f*f;return Math.sqrt(e)},manhattan:function(a,b){var c=a.length,d=-1,e=0;while(++d<c)e+=Math.abs(a[d]-b[d]);return e},minkowski:function(a){return function(b,c){var d=b.length,e=-1,f=0;while(++e<d)f+=Math.pow(Math.abs(b[e]-c[e]),a);return Math.pow(f,1/a)}},chebyshev:function(a,b){var c=a.length,d=-1,e=0,f;while(++d<c)f=Math.abs(a[d]-b[d]),f>e&&(e=f);return e},hamming:function(a,b){var c=a.length,d=-1,e=0;while(++d<c)a[d]!==b[d]&&e++;return e},jaccard:function(a,b){var c=a.length,d=-1,e=0;while(++d<c)a[d]===b[d]&&e++;return e/c},braycurtis:function(a,b){var c=a.length,d=-1,e=0,f=0,g,h;while(++d<c)g=a[d],h=b[d],e+=Math.abs(g-h),f+=Math.abs(g+h);return e/f}},science.stats.erf=function(a){var b=.254829592,c=-0.284496736,d=1.421413741,e=-1.453152027,f=1.061405429,g=.3275911,h=a<0?-1:1;a<0&&(h=-1,a=-a);var i=1/(1+g*a);return h*(1-((((f*i+e)*i+d)*i+c)*i+b)*i*Math.exp(-a*a))},science.stats.phi=function(a){return.5*(1+science.stats.erf(a/Math.SQRT2))},science.stats.kernel={uniform:function(a){return a<=1&&a>=-1?.5:0},triangular:function(a){return a<=1&&a>=-1?1-Math.abs(a):0},epanechnikov:function(a){return a<=1&&a>=-1?.75*(1-a*a):0},quartic:function(a){if(a<=1&&a>=-1){var b=1-a*a;return.9375*b*b}return 0},triweight:function(a){if(a<=1&&a>=-1){var b=1-a*a;return 35/32*b*b*b}return 0},gaussian:function(a){return 1/Math.sqrt(2*Math.PI)*Math.exp(-0.5*a*a)},cosine:function(a){return a<=1&&a>=-1?Math.PI/4*Math.cos(Math.PI/2*a):0}},science.stats.kde=function(){function d(d,e){var f=c.call(this,b);return d.map(function(c){var d=-1,e=0,g=b.length;while(++d<g)e+=a((c-b[d])/f);return[c,e/f/g]})}var a=science.stats.kernel.gaussian,b=[],c=science.stats.bandwidth.nrd;return d.kernel=function(b){return arguments.length?(a=b,d):a},d.sample=function(a){return arguments.length?(b=a,d):b},d.bandwidth=function(a){return arguments.length?(c=science.functor(a),d):c},d},science.stats.kmeans=function(){function f(f){var g=f.length,h=[],i=[],j=1,l=0,m=c(e,f),n,o,p,q,r,s,t;while(j&&l<d){p=-1;while(++p<e)i[p]=0;o=-1;while(++o<g){q=f[o],s=Infinity,p=-1;while(++p<e)r=a.call(this,m[p],q),r<s&&(s=r,t=p);i[h[o]=t]++}n=[],o=-1;while(++o<g){q=h[o],r=n[q];if(r==null)n[q]=f[o].slice();else{p=-1;while(++p<r.length)r[p]+=f[o][p]}}p=-1;while(++p<e){q=n[p],r=1/i[p],o=-1;while(++o<q.length)q[o]*=r}j=0,p=-1;while(++p<e)if(!b(n[p],m[p])){j=1;break}m=n,l++}return{assignments:h,centroids:m}}var a=science.stats.distance.euclidean,d=1e3,e=1;return f.k=function(a){return arguments.length?(e=a,f):e},f.distance=function(b){return arguments.length?(a=b,f):a},f},science.stats.hcluster=function(){function c(c){var e=c.length,f=[],g=[],h=[],i=[],j,k,l,m,n,o,p,q;p=-1;while(++p<e){f[p]=0,h[p]=[],q=-1;while(++q<e)h[p][q]=p===q?Infinity:a(c[p],c[q]),h[p][f[p]]>h[p][q]&&(f[p]=q)}p=-1;while(++p<e)i[p]=[],i[p][0]={left:null,right:null,dist:0,centroid:c[p],size:1,depth:0},g[p]=1;for(n=0;n<e-1;n++){j=0;for(p=0;p<e;p++)h[p][f[p]]<h[j][f[j]]&&(j=p);k=f[j],l=i[j][0],m=i[k][0];var r={left:l,right:m,dist:h[j][k],centroid:d(l.size,l.centroid,m.size,m.centroid),size:l.size+m.size,depth:1+Math.max(l.depth,m.depth)};i[j].splice(0,0,r),g[j]+=g[k];for(q=0;q<e;q++)switch(b){case"single":h[j][q]>h[k][q]&&(h[q][j]=h[j][q]=h[k][q]);break;case"complete":h[j][q]<h[k][q]&&(h[q][j]=h[j][q]=h[k][q]);break;case"average":h[q][j]=h[j][q]=(g[j]*h[j][q]+g[k]*h[k][q])/(g[j]+g[q])}h[j][j]=Infinity;for(p=0;p<e;p++)h[p][k]=h[k][p]=Infinity;for(q=0;q<e;q++)f[q]==k&&(f[q]=j),h[j][q]<h[j][f[j]]&&(f[j]=q);o=r}return o}var a=science.stats.distance.euclidean,b="single";return c.distance=function(b){return arguments.length?(a=b,c):a},c},science.stats.iqr=function(a){var b=science.stats.quantiles(a,[.25,.75]);return b[1]-b[0]},science.stats.loess=function(){function d(d,i,j){var k=d.length,l;if(k!==i.length)throw{error:"Mismatched array lengths"};if(k==0)throw{error:"At least one point required."};if(arguments.length<3){j=[],l=-1;while(++l<k)j[l]=1}e(d),e(i),e(j),f(d);if(k==1)return[i[0]];if(k==2)return[i[0],i[1]];var m=Math.floor(a*k);if(m<2)throw{error:"Bandwidth too small."};var n=[],o=[],p=[];l=-1;while(++l<k)n[l]=0,o[l]=0,p[l]=1;var q=-1;while(++q<=b){var r=[0,m-1],s;l=-1;while(++l<k){s=d[l],l>0&&h(d,j,l,r);var t=r[0],u=r[1],v=d[l]-d[t]>d[u]-d[l]?t:u,w=0,x=0,y=0,z=0,A=0,B=Math.abs(1/(d[v]-s));for(var C=t;C<=u;++C){var D=d[C],E=i[C],F=C<l?s-D:D-s,G=g(F*B)*p[C]*j[C],H=D*G;w+=G,x+=H,y+=D*H,z+=E*G,A+=E*H}var I=x/w,J=z/w,K=A/w,L=y/w,M=Math.sqrt(Math.abs(L-I*I))<c?0:(K-I*J)/(L-I*I),N=J-M*I;n[l]=M*s+N,o[l]=Math.abs(i[l]-n[l])}if(q===b)break;var O=o.slice();O.sort();var P=O[Math.floor(k/2)];if(Math.abs(P)<c)break;var Q,G;l=-1;while(++l<k)Q=o[l]/(6*P),p[l]=Q>=1?0:(G=1-Q*Q)*G}return n}var a=.3,b=2,c=1e-12;return d.bandwidth=function(b){return arguments.length?(a=b,d):b},d.robustnessIterations=function(a){return arguments.length?(b=a,d):a},d.accuracy=function(a){return arguments.length?(c=a,d):a},d},science.stats.mean=function(a){var b=a.length;if(b===0)return NaN;var c=0,d=-1;while(++d<b)c+=(a[d]-c)/(d+1);return c},science.stats.median=function(a){return science.stats.quantiles(a,[.5])[0]},science.stats.mode=function(a){var b={},c=[],d=0,e=a.length,f=-1,g,h;while(++f<e)h=b.hasOwnProperty(g=a[f])?++b[g]:b[g]=1,h===d?c.push(g):h>d&&(d=h,c=[g]);if(c.length===1)return c[0]},science.stats.quantiles=function(a,b){a=a.slice().sort(science.ascending);var c=a.length-1;return b.map(function(b){if(b===0)return a[0];if(b===1)return a[c];var d=1+b*c,e=Math.floor(d),f=d-e,g=a[e-1];return f===0?g:g+f*(a[e]-g)})},science.stats.variance=function(a){var b=a.length;if(b<1)return NaN;if(b===1)return 0;var c=science.stats.mean(a),d=-1,e=0;while(++d<b){var f=a[d]-c;e+=f*f}return e/(b-1)},science.stats.distribution={},science.stats.distribution.gaussian=function(){function e(){var d,e,f,g;do d=2*a()-1,e=2*a()-1,f=d*d+e*e;while(f>=1||f===0);return b+c*d*Math.sqrt(-2*Math.log(f)/f)}var a=Math.random,b=0,c=1,d=1;return e.pdf=function(a){return a=(a-b)/c,science_stats_distribution_gaussianConstant*Math.exp(-0.5*a*a)/c},e.cdf=function(a){return a=(a-b)/c,.5*(1+science.stats.erf(a/Math.SQRT2))},e.mean=function(a){return arguments.length?(b=+a,e):b},e.variance=function(a){return arguments.length?(c=Math.sqrt(d=+a),e):d},e.random=function(b){return arguments.length?(a=b,e):a},e},science_stats_distribution_gaussianConstant=1/Math.sqrt(2*Math.PI)}(this)})(this);

(function(exports){reorder={version:"1.0.2"};reorder.debug=false;reorder.cmp_number_asc=function(a,b){return a-b};reorder.cmp_number=reorder.cmp_number_asc;reorder.cmp_number_desc=function(a,b){return b-a};reorder.flatten=function(a,b){return a.concat(b)};reorder.infinities=function(n){var i=-1,a=[];if(arguments.length===1)while(++i<n)a[i]=Infinity;else while(++i<n)a[i]=reorder.infinities.apply(this,Array.prototype.slice.call(arguments,1));return a};reorder.array1d=function(n,v){var i=-1,a=Array(n);while(++i<n)a[i]=v;return a};function check_distance_matrix(mat,tol){var i,j,v1,v2,n=mat.length,row;if(!tol)tol=1e-10;if(n!=mat[0].length)return"Inconsistent dimensions";for(i=0;i<n-1;i++){row=mat[i];v1=row[i];if(v1<0)return"Negative value at diagonal "+i;if(v1>tol)return"Diagonal not zero at "+i;for(j=1;j<n;j++){v1=row[j];v2=mat[j][i];if(Math.abs(v1-v2)>tol)return"Inconsistency at "+i+","+j;if(v1<0)return"Negative value at "+i+","+j;if(v2<0)return"Negative value at "+j+","+i}}return false}function fix_distance_matrix(mat,tol){var i,j,v1,v2,n=mat.length,row;if(!tol)tol=1e-10;if(n!=mat[0].length)throw"Inconsistent dimensions "+n+" != "+mat[0].length;for(i=0;i<n-1;i++){row=mat[i];v1=row[i];if(v1<0){if(-v1>tol)throw"Negative value at diagonal"+i;v1=row[i]=0}else if(v1>tol){throw"Diagonal not zero at "+i}for(j=1;j<n;j++){v1=row[j];v2=mat[j][i];if(Math.abs(v1-v2)>tol)throw"Inconsistency at "+i+","+j;if(v1<0)v1=0;if(v2<0)v2=0;if(v1!=v2){v1+=v2;v1/=2}row[j]=v1;mat[j][i]=v1}}return mat}reorder.dot=science.lin.dot;reorder.length=science.lin.length;reorder.normalize=science.lin.normalize;reorder.zeroes=science.zeroes;reorder.displaymat=function(mat,rowperm,colperm){var i,j,row,col,str;console.log("Matrix:");for(i=0;i<mat.length;i++){row=rowperm?mat[rowperm[i]]:mat[i];str="";for(j=0;j<row.length;j++){col=colperm?row[colperm[j]]:row[j];str+=col?"*":" "}console.log(str)}};reorder.printvec=function(row,prec,colperm,line){var j;if(!line)line="";for(j=0;j<row.length;j++){if(line.length!==0)line+=", ";if(colperm)line+=row[colperm[j]].toFixed(prec);else line+=row[j].toFixed(prec)}console.log(line)};reorder.printmat=function(m,prec,rowperm,colperm){var i,j,row,line;if(!prec)prec=4;for(i=0;i<m.length;i++){row=rowperm?m[rowperm[i]]:m[i];reorder.printvec(row,prec,colperm,i+": ")}};reorder.assert=function(v,msg){if(!v){console.log(msg);throw msg||"Assertion failed"}};reorder.printhcluster=function(cluster,indent){if(cluster.left===null)return Array(indent+1).join(" ")+"id: "+cluster.id;return Array(indent+1).join(" ")+"id: "+cluster.id+", dist: "+cluster.dist+"\n"+reorder.printhcluster(cluster.left,indent+1)+"\n"+reorder.printhcluster(cluster.right,indent+1)};reorder.mean=science.stats.mean;reorder.meantranspose=function(v,j){var n=v.length;if(n===0)return NaN;var o=v[0].length,m=0,i=-1,row;while(++i<n)m+=(v[i][j]-m)/(i+1);return m};reorder.meancolumns=function(v){var n=v.length;if(n===0)return NaN;var o=v[0].length,m=v[0].slice(0),i=0,j,row;while(++i<n){row=v[i];for(j=0;j<o;j++)m[j]+=(row[j]-m[j])/(i+1)}return m};function sum(v){var i=v.length,s=0;while(i-->0)if(!isNaN(v[i]))s+=v[i];return s}reorder.sum=sum;function isNum(a,b){return!(isNaN(a)||isNaN(b)||a==Infinity||b==Infinity)}reorder.distance={euclidean:function(a,b){var i=a.length,s=0,x;while(i-->0){if(isNum(a[i],b[i])){x=a[i]-b[i];s+=x*x}}return Math.sqrt(s)},manhattan:function(a,b){var i=a.length,s=0;while(i-->0){if(isNum(a[i],b[i])){s+=Math.abs(a[i]-b[i])}}return s},minkowski:function(p){return function(a,b){var i=a.length,s=0;while(i-->0){if(isNum(a[i],b[i])){s+=Math.pow(Math.abs(a[i]-b[i]),p)}}return Math.pow(s,1/p)}},chebyshev:function(a,b){var i=a.length,max=0,x;while(i-->0){if(isNum(a[i],b[i])){x=Math.abs(a[i]-b[i]);if(x>max)max=x}}return max},hamming:function(a,b){var i=a.length,d=0;while(i-->0){if(isNum(a[i],b[i])){if(a[i]!==b[i])d++}}return d},jaccard:function(a,b){var n=0,i=a.length,s=0;while(i-->0){if(isNum(a[i],b[i])){if(a[i]===b[i])s++;n++}}if(n===0)return 0;return s/n},braycurtis:function(a,b){var i=a.length,s0=0,s1=0,ai,bi;while(i-->0){ai=a[i];bi=b[i];if(isNum(ai,bi)){s0+=Math.abs(ai-bi);s1+=Math.abs(ai+bi)}}if(s1===0)return 0;return s0/s1}};reorder.range=function(start,stop,step){if(arguments.length<3){step=1;if(arguments.length<2){stop=start;start=0}}var range=[],i=start;if(step<0)for(;i>stop;i+=step)range.push(i);else for(;i<stop;i+=step)range.push(i);return range};reorder.transpose=science.lin.transpose;reorder.transposeSlice=function(a,start,end){if(arguments.length<3){end=a[0].length;if(arguments.length<2){start=0}}var m=a.length,n=end,i=start-1,j,b=new Array(end-start);while(++i<n){b[i]=new Array(m);j=-1;while(++j<m)b[i-start][j]=a[j][i]}return b};reorder.correlation={pearson:function(a,b){var ma=science.stats.mean(a),mb=science.stats.mean(b),s1=0,s2=0,s3=0,i,dx,dy,n=Math.min(a.length,b.length);if(n===0)return NaN;for(i=0;i<n;i++){dx=a[i]-ma;dy=b[i]-mb;s1+=dx*dy;s2+=dx*dx;s3+=dy*dy}return s1/Math.sqrt(s2*s3)},pearsonMatrix:function(matrix){var a,ma,i,j,dx,cor=reorder.correlation.pearson,n=matrix.length,ret,mx,sx,sx2;if(n===0)return NaN;ret=reorder.zeroes(n,n);for(i=0;i<n-1;i++){for(j=i+1;j<n;j++){var p=cor(matrix[i],matrix[j]);ret[i][j]=ret[j][i]=p}}return ret}};reorder.bandwidth=function(graph,order){if(!order)order=reorder.range(graph.nodes().length);var inv=inverse_permutation(order),links=graph.links(),i,e,d,max=0;for(i=0;i<links.length;i++){e=links[i];d=Math.abs(inv[e.source.index]-inv[e.target.index]);max=Math.max(max,d)}return max};reorder.edgesum=function(graph,order){if(!order)order=reorder.range(graph.nodes().length);var inv=inverse_permutation(order),links=graph.links(),i,e,d,sum=0;for(i=0;i<links.length;i++){e=links[i];d=Math.abs(inv[e.source.index]-inv[e.target.index]);sum+=d}return sum};reorder.permutation=reorder.range;function inverse_permutation(perm,dense){var inv=dense?Array(perm.length):{};for(var i=0;i<perm.length;i++){inv[perm[i]]=i}return inv}reorder.inverse_permutation=inverse_permutation;reorder.graph=function(nodes,links,directed){var graph={},linkDistance=1,edges,inEdges,outEdges,components;graph.nodes=function(x){if(!arguments.length)return nodes;nodes=x;return graph};graph.nodes_indices=function(){return nodes.map(function(n){return n.index})};graph.generate_nodes=function(n){nodes=[];for(var i=0;i<n;i++)nodes.push({id:i});return graph};graph.links=function(x){if(!arguments.length)return links;links=x;return graph};graph.links_indices=function(){return links.map(function(l){return{source:l.source.index,target:l.target.index}})};graph.linkDistance=function(x){if(!arguments.length)return linkDistance;linkDistance=typeof x==="function"?x:+x;return graph};graph.directed=function(x){if(!arguments.length)return directed;directed=x;return graph};function init(){var i,o,n=nodes.length,m=links.length;components=undefined;for(i=0;i<n;++i){(o=nodes[i]).index=i;o.weight=0}for(i=0;i<m;++i){(o=links[i]).index=i;if(typeof o.source=="number")o.source=nodes[o.source];if(typeof o.target=="number")o.target=nodes[o.target];if(!("value"in o))o.value=1;++o.source.weight;++o.target.weight}if(typeof linkDistance==="function")for(i=0;i<m;++i)links[i].distance=+linkDistance.call(this,links[i],i);else for(i=0;i<m;++i)links[i].distance=linkDistance;edges=Array(nodes.length);for(i=0;i<nodes.length;++i){edges[i]=[]}if(directed){inEdges=Array(nodes.length);outEdges=Array(nodes.length);for(i=0;i<nodes.length;++i){inEdges[i]=[];outEdges[i]=[]}}else{inEdges=outEdges=edges}for(i=0;i<links.length;++i){o=links[i];edges[o.source.index].push(o);if(o.source.index!=o.target.index)edges[o.target.index].push(o);if(directed)inEdges[o.source.index].push(o);if(directed)outEdges[o.target.index].push(o)}return graph}graph.init=init;graph.edges=function(node){if(typeof node!="number"){node=node.index;if(reorder.debug){console.log("received node %d",node)}}return edges[node]};graph.degree=function(node){if(typeof node!="number")node=node.index;return edges[node].length};graph.inEdges=function(node){if(typeof node!="number")node=node.index;return inEdges[node]};graph.inDegree=function(node){if(typeof node!="number")node=node.index;return inEdges[node].length};graph.outEdges=function(node){if(typeof node!="number")node=node.index;return outEdges[node]};graph.outDegree=function(node){if(typeof node!="number")node=node.index;return outEdges[node].length};graph.sinks=function(){var sinks=[],i;for(i=0;i<nodes.length;i++){if(graph.outEdges(i).length===0)sinks.push(i)}return sinks};graph.sources=function(){var sources=[],i;for(i=0;i<nodes.length;i++){if(graph.inEdges(i).length===0)sources.push(i)}return sources};function distance(i){return links[i].distance}graph.distance=distance;function neighbors(node){var e=edges[node],ret=[];for(var i=0;i<e.length;++i){var o=e[i];if(o.source.index==node)ret.push(o.target);else ret.push(o.source)}return ret}graph.neighbors=neighbors;graph.other=function(o,node){if(typeof o=="number")o=links[o];if(o.source.index==node)return o.target;else return o.source};function compute_components(){var stack=[],comp=0,comps=[],ccomp,n=nodes.length,i,j,v,l,o,e;for(i=0;i<n;i++)nodes[i].comp=0;for(j=0;j<n;j++){if(nodes[j].comp!==0)continue;comp=comp+1;nodes[j].comp=comp;stack.push(j);ccomp=[j];while(stack.length){v=stack.shift();l=edges[v];for(i=0;i<l.length;i++){e=l[i];o=e.source;if(o.index==v)o=e.target;if(o.index==v)continue;if(o.comp===0){o.comp=comp;ccomp.push(o.index);stack.push(o.index)}}}if(ccomp.length){ccomp.sort(reorder.cmp_number);comps.push(ccomp)}}comps.sort(function(a,b){return b.length-a.length});return comps}graph.components=function(){if(!components)components=compute_components();return components};return graph};reorder.graph_random_erdos_renyi=function(n,p,directed){if(p<=0)return reorder.graph_empty(n,directed);else if(p>=1)return reorder.graph_complete(n,directed);var nodes=graph_empty_nodes(n),links=[],v,w,i,lr,lp;w=-1;lp=Math.log(1-p);if(directed){for(v=0;v<n;){lr=Math.log(1-Math.random());w=w+1+Math.floor(lr/lp);if(v==w)w=w+1;while(w>=n&&v<n){w=w-n;v=v+1;if(v==w)w=w+1}if(v<n)links.push({source:v,target:w})}}else{for(v=1;v<n;){lr=Math.log(1-Math.random());w=w+1+Math.floor(lr/lp);while(w>=v&&v<n){w=w-v;v=v+1}if(v<n)links.push({source:v,target:w})}}return reorder.graph(nodes,links,directed).init()};reorder.graph_random=reorder.graph_random_erdos_renyi;function graph_empty_nodes(n){var nodes=Array(n),i;for(i=0;i<n;i++)nodes[i]={id:i};return nodes}reorder.graph_empty_nodes=graph_empty_nodes;reorder.graph_empty=function(n,directed){return graph(graph_empty_nodes(n),[],directed)};reorder.complete_graph=function(n,directed){var nodes=graph_empty_nodes(n),links=[],i,j;if(directed){for(i=0;i<n;i++){for(j=0;j<n;j++){if(i!=j)links.push({source:i,target:j})}}}else{for(i=0;i<n-1;i++){for(j=i+1;j<n;j++)links.push({source:i,target:j})}}return reorder.graph(nodes,links,directed).init()};reorder.graph_connect=function(graph,comps){var i,j,links=graph.links();if(!comps)comps=graph.components();for(i=0;i<comps.length-1;i++){for(j=i+1;j<comps.length;j++){links.push({source:comps[i][0],target:comps[j][0]})}}graph.links(links);return graph.init()};reorder.bfs=function(graph,v,fn){var q=new Queue,discovered={},i,e,v2,edges;q.push(v);discovered[v]=true;fn(v,undefined);while(q.length){v=q.shift();fn(v,v);edges=graph.edges(v);for(i=0;i<edges.length;i++){e=edges[i];v2=graph.other(e,v).index;if(!discovered[v2]){q.push(v2);discovered[v2]=true;fn(v,v2)}}fn(v,-1)}};reorder.bfs_distances=function(graph,v){var dist={};dist[v]=0;reorder.bfs(graph,v,function(v,c){if(c>=0&&v!=c)dist[c]=dist[v]+1});return dist};reorder.all_pairs_distance_bfs=function(graph,comps){if(!comps)comps=[graph.nodes_indices()];var nodes=comps.reduce(reorder.flatten).sort(reorder.cmp_number),mat=Array(nodes.length),i,j,dist;for(i=0;i<nodes.length;i++)mat[i]=Array(nodes.length);for(i=0;i<nodes.length;i++){dist=reorder.bfs_distances(graph,i);for(j in dist){mat[i][j]=dist[j];mat[j][i]=dist[j]}}return mat};bfs_order=function(graph,comps){if(!comps)comps=graph.components();var i,comp,order=[];for(i=0;i<comps.length;i++){comp=comps[i];reorder.bfs(graph,comp[0],function(v,c){if(c>=0&&v!=c)order.push(v)})}return order};reorder.mat2graph=function(mat,directed){var n=mat.length,nodes=[],links=[],max_value=Number.NEGATIVE_INFINITY,i,j,v,m;for(i=0;i<n;i++)nodes.push({id:i});for(i=0;i<n;i++){v=mat[i];m=directed?0:i;for(j=m;j<v.length;j++){if(j==nodes.length)nodes.push({id:j});if(v[j]!==0){if(v[j]>max_value)max_value=v[j];links.push({source:i,target:j,value:v[j]})}}}return reorder.graph(nodes,links,directed).linkDistance(function(l,i){return 1+max_value-l.value}).init()};reorder.graph2mat=function(graph,directed){var nodes=graph.nodes(),links=graph.links(),n=nodes.length,i,l,mat;if(!directed)directed=graph.directed();if(directed){var rows=n,cols=n;for(i=n-1;i>=0;i--){if(graph.inEdges(i).length!==0)break;else rows--}for(i=n-1;i>=0;i--){if(graph.outEdges(i).length!==0)break;else cols--}mat=reorder.zeroes(rows,cols);for(i=0;i<links.length;i++){l=links[i];mat[l.source.index][l.target.index]=l.value?l.value:1}}else{mat=reorder.zeroes(n,n);for(i=0;i<links.length;i++){l=links[i];mat[l.source.index][l.target.index]=l.value?l.value:1;mat[l.target.index][l.source.index]=l.value?l.value:1}}return mat};function count_crossings(graph,north,south){var i,j,n,firstIndex,treeSize,tree,index,weightSum,invert=false,crosscount;var comp=reorder.permutation(graph.nodes().length);if(north===undefined){north=comp.filter(function(n){return graph.outDegree(n)!==0});south=comp.filter(function(n){return graph.inDegree(n)!==0})}if(north.length<south.length){var tmp=north;north=south;south=tmp;invert=true}var south_inv=inverse_permutation(south),southsequence=[];for(i=0;i<north.length;i++){if(invert){n=graph.inEdges(north[i]).map(function(e){return south_inv[e.target.index]})}else{n=graph.outEdges(north[i]).map(function(e){return south_inv[e.source.index]})}n.sort(reorder.cmp_number);southsequence=southsequence.concat(n)}firstIndex=1;while(firstIndex<south.length)firstIndex<<=1;treeSize=2*firstIndex-1;firstIndex-=1;tree=reorder.zeroes(treeSize);crosscount=0;for(i=0;i<southsequence.length;i++){index=southsequence[i]+firstIndex;tree[index]++;while(index>0){if(index%2)crosscount+=tree[index+1];index=index-1>>1;tree[index]++}}return crosscount}reorder.count_crossings=count_crossings;function count_in_crossings(graph,v,w,inv){var v_edges=graph.inEdges(v),w_edges=graph.inEdges(w),iv,iw,p0,cross=0;for(iw=0;iw<w_edges.length;iw++){p0=inv[w_edges[iw].target.index];for(iv=0;iv<v_edges.length;iv++){if(inv[v_edges[iv].target.index]>p0)cross++}}return cross}function count_out_crossings(graph,v,w,inv){var v_edges=graph.outEdges(v),w_edges=graph.outEdges(w),iv,iw,p0,cross=0;for(iw=0;iw<w_edges.length;iw++){p0=inv[w_edges[iw].source.index];for(iv=0;iv<v_edges.length;iv++){if(inv[v_edges[iv].source.index]>p0)cross++}}return cross}function adjacent_exchange(graph,layer1,layer2){layer1=layer1.slice();layer2=layer2.slice();var i,v,w,c0,c1,inv_layer1=inverse_permutation(layer1),inv_layer2=inverse_permutation(layer2),swapped=true,improved=0;while(swapped){swapped=false;for(i=0;i<layer1.length-1;i++){v=layer1[i];w=layer1[i+1];c0=count_out_crossings(graph,v,w,inv_layer2);c1=count_out_crossings(graph,w,v,inv_layer2);if(c0>c1){layer1[i]=w;layer1[i+1]=v;inv_layer1[w]=i;inv_layer1[v]=i+1;swapped=true;improved+=c0-c1}}for(i=0;i<layer2.length-1;i++){v=layer2[i];w=layer2[i+1];c0=count_in_crossings(graph,v,w,inv_layer1);c1=count_in_crossings(graph,w,v,inv_layer1);if(c0>c1){layer2[i]=w;layer2[i+1]=v;inv_layer2[w]=i;inv_layer2[v]=i+1;swapped=true;improved+=c0-c1}}}return[layer1,layer2,improved]}reorder.adjacent_exchange=adjacent_exchange;reorder.barycenter_order=function(graph,comps,max_iter){var orders=[[],[],0];if(!comps){comps=graph.components()}for(var i=0;i<comps.length;i++){var o=reorder.barycenter(graph,comps[i],max_iter);orders=[orders[0].concat(o[0]),orders[1].concat(o[1]),orders[2]+o[2]]}return orders};function median(neighbors){if(neighbors.length===0)return-1;if(neighbors.length===1)return neighbors[0];if(neighbors.length===2)return(neighbors[0]+neighbors[1])/2;neighbors.sort(reorder.cmp_number);if(neighbors.length%2)return neighbors[(neighbors.length-1)/2];var rm=neighbors.length/2,lm=rm-1,rspan=neighbors[neighbors.length-1]-neighbors[rm],lspan=neighbors[lm]-neighbors[0];if(lspan==rspan)return(neighbors[lm]+neighbors[rm])/2;else return(neighbors[lm]*rspan+neighbors[rm]*lspan)/(lspan+rspan)}reorder.barycenter=function(graph,comp,max_iter){var nodes=graph.nodes(),layer1,layer2,crossings,iter,best_layer1,best_layer2,best_crossings,best_iter,layer,inv_layer={},i,v,neighbors,med;layer1=comp.filter(function(n){return graph.outDegree(n)!==0});layer2=comp.filter(function(n){return graph.inDegree(n)!==0});if(comp.length<3){return[layer1,layer2,count_crossings(graph,layer1,layer2)]}if(!max_iter)max_iter=24;else if(max_iter%2==1)max_iter++;inv_layer=inverse_permutation(layer2);best_crossings=count_crossings(graph,layer1,layer2);best_layer1=layer1.slice();best_layer2=layer2.slice();best_iter=0;var inv_neighbor=function(e){var n=e.source==v?e.target:e.source;return inv_layer[n.index]},barycenter_sort=function(a,b){var d=med[a]-med[b];if(d===0){d=graph.edges(b).length%2-graph.edges(a).length%2}if(d<0)return-1;else if(d>0)return 1;return 0};for(layer=layer1,iter=0;iter<max_iter;iter++,layer=layer==layer1?layer2:layer1){med={};for(i=0;i<layer.length;i++){v=nodes[layer[i]];if(layer==layer1)neighbors=graph.outEdges(v.index);else neighbors=graph.inEdges(v.index);neighbors=neighbors.map(inv_neighbor);med[v.index]=+median(neighbors)}layer.sort(barycenter_sort);for(i=0;i<layer.length;i++)inv_layer=inverse_permutation(layer);crossings=count_crossings(graph,layer1,layer2);if(crossings<best_crossings){best_crossings=crossings;best_layer1=layer1.slice();best_layer2=layer2.slice();best_iter=iter;max_iter=Math.max(max_iter,iter+2)}}if(reorder.debug){console.log("Best iter: "+best_iter)}return[best_layer1,best_layer2,best_crossings]};reorder.all_pairs_distance=function(graph,comps){var distances=[];if(!comps)comps=graph.components();for(var i=0;i<comps.length;i++)distances.push(all_pairs_distance_floyd_warshall(graph,comps[i]));return distances};function all_pairs_distance_floyd_warshall(graph,comp){var dist=reorder.infinities(comp.length,comp.length),i,j,k,inv;inv=inverse_permutation(comp);for(i=0;i<comp.length;i++)dist[i][i]=0;var build_dist=function(e){if(e.source==e.target)return;if(!(e.source.index in inv)||!(e.target.index in inv))return;var u=inv[e.source.index],v=inv[e.target.index];dist[v][u]=dist[u][v]=graph.distance(e.index)};for(i=0;i<comp.length;i++){graph.edges(comp[i]).forEach(build_dist)}for(k=0;k<comp.length;k++){for(i=0;i<comp.length;i++)if(dist[i][k]!=Infinity){for(j=0;j<comp.length;j++)if(dist[k][j]!=Infinity&&dist[i][j]>dist[i][k]+dist[k][j]){dist[i][j]=dist[i][k]+dist[k][j];dist[j][i]=dist[i][j]}}}return dist}reorder.all_pairs_distance_floyd_warshall=all_pairs_distance_floyd_warshall;function floyd_warshall_with_path(graph,comp){if(!comp)comp=graph.components()[0];var dist=reorder.infinities(comp.length,comp.length),next=Array(comp.length),directed=graph.directed(),i,j,k,inv;inv=inverse_permutation(comp);for(i=0;i<comp.length;i++){dist[i][i]=0;next[i]=Array(comp.length)}var build_dist=function(e){if(e.source==e.target)return;var u=inv[e.source.index],v=inv[e.target.index];dist[u][v]=graph.distance(e);next[u][v]=v;if(!directed){dist[v][u]=graph.distance(e);next[v][u]=u}};for(i=0;i<comp.length;i++){graph.edges(comp[i]).forEach(build_dist)}for(k=0;k<comp.length;k++){for(i=0;i<comp.length;i++){for(j=0;j<comp.length;j++){if(dist[i][j]>dist[i][k]+dist[k][j]){dist[i][j]=dist[i][k]+dist[k][j];next[i][j]=next[i][k];if(!directed){dist[j][i]=dist[i][j];next[j][i]=next[k][j]}}}}}return[dist,next]}reorder.floyd_warshall_with_path=floyd_warshall_with_path;function floyd_warshall_path(next,u,v){if(next[u][v]===undefined)return[];var path=[u];while(u!=v){u=next[u][v];path.push(u)}return path}reorder.floyd_warshall_path=floyd_warshall_path;function distmat2valuemat(distmat){var n=distmat.length,valuemat=reorder.zeroes(n,n),max_dist=reorder.distmax(distmat),i,j;for(i=0;i<n;i++){for(j=i;j<n;j++){valuemat[j][i]=valuemat[i][j]=1+max_dist-distmat[i][j]}}return valuemat}reorder.distmat2valuemat=distmat2valuemat;reorder.graph2valuemats=function(graph,comps){if(!comps)comps=graph.components();var dists=reorder.all_pairs_distance(graph,comps);return dists.map(distmat2valuemat)};reorder.valuemats_reorder=function(valuemats,leaforder,comps){var orders=valuemats.map(leaforder);if(comps){orders=orders.map(function(d,i){return reorder.permute(comps[i],d)})}return orders.reduce(reorder.flatten)};reorder.dist=function(){var distance=reorder.distance.euclidean;function dist(vectors){var n=vectors.length,distMatrix=[];for(var i=0;i<n;i++){var d=[];distMatrix[i]=d;for(var j=0;j<n;j++){if(j<i){d.push(distMatrix[j][i])}else if(i===j){d.push(0)}else{d.push(distance(vectors[i],vectors[j]))}}}return distMatrix}dist.distance=function(x){if(!arguments.length)return distance;distance=x;return dist};return dist};reorder.distmax=function(distMatrix){var max=0,n=distMatrix.length,i,j,row;for(i=0;i<n;i++){row=distMatrix[i];for(j=i+1;j<n;j++)if(row[j]>max)max=row[j]}return max};reorder.distmin=function(distMatrix){var min=Infinity,n=distMatrix.length,i,j,row;for(i=0;i<n;i++){row=distMatrix[i];for(j=i+1;j<n;j++)if(row[j]<min)min=row[j]}return min};reorder.dist_remove=function(dist,n,m){if(arguments.length<3)m=n+1;var i;dist.splice(n,m-n);for(i=dist.length;i-->0;)dist[i].splice(n,m-n);return dist};reorder.randomPermute=function(array,i,j){if(arguments.length<3){j=array.length;if(arguments.length<2){i=0}}var m=j-i,t,k;while(m>0){k=i+Math.floor(Math.random()*m--);t=array[i+m];array[i+m]=array[k];array[k]=t}return array};reorder.randomPermutation=function(n){return reorder.randomPermute(reorder.permutation(n))};reorder.random_array=function(n,min,max){var ret=Array(n);if(arguments.length==1){while(n)ret[--n]=Math.random()}else if(arguments.length==2){while(n)ret[--n]=Math.random()*min}else{while(n)ret[--n]=min+Math.random()*(max-min)}return ret};reorder.random_matrix=function(p,n,m,sym){if(!m)m=n;if(n!=m)sym=false;else if(!sym)sym=true;var mat=reorder.zeroes(n,m),i,j,cnt;if(sym){for(i=0;i<n;i++){cnt=0;for(j=0;j<i+1;j++){if(Math.random()<p){mat[i][j]=mat[j][i]=1;cnt++}}if(cnt===0){j=Math.floor(Math.random()*n/2);mat[i][j]=mat[j][i]=1}}}else{for(i=0;i<n;i++){cnt=0;for(j=0;j<m;j++){if(Math.random()<p){mat[i][j]=1;cnt++}}if(cnt===0)mat[i][Math.floor(Math.random()*m)]=1}}return mat};function permute_copy(list,perm){var m=perm.length;var copy=list.slice();while(m--)copy[m]=list[perm[m]];return copy}reorder.permute=permute_copy;function permute_inplace(list,perm){var i,j,v,tmp;for(i=0;i<list.length;i++){j=perm[i];if(j<0){perm[i]=-1-j;continue}v=i;while(j!=i){tmp=list[j];list[j]=list[v];list[v]=tmp;v=j;tmp=perm[j];perm[j]=-1-tmp;j=tmp}}return list}reorder.permute_inplace=permute_inplace;reorder.permutetranspose=function(array,indexes){var m=array.length;while(m-->0)array[m]=reorder.permute(array[m],indexes);return array};reorder.stablepermute=function(list,indexes){var p=reorder.permute(list,indexes);if(p[0]>p[p.length-1]){p.reverse()}return p};reorder.sort_order=function(v){return reorder.permutation(0,v.length).sort(function(a,b){return v[a]-v[b]})};reorder.sort_order_ascending=reorder.sort_order;reorder.sort_order_descending=function(v){return reorder.permutation(0,v.length).sort(function(a,b){return v[b]-v[a]})};if(typeof science=="undefined"){science={version:"1.9.1"};science.stats={}}science.stats.hcluster=function(){var distance=reorder.distance.euclidean,linkage="single",distMatrix=null;function hcluster(vectors){var n=vectors.length,dMin=[],cSize=[],clusters=[],c1,c2,c1Cluster,c2Cluster,p,root,i,j,id=0;if(distMatrix===null){distMatrix=[];i=-1;while(++i<n){dMin[i]=0;distMatrix[i]=[];j=-1;while(++j<n){distMatrix[i][j]=i===j?Infinity:distance(vectors[i],vectors[j]);if(distMatrix[i][dMin[i]]>distMatrix[i][j])dMin[i]=j}}}else{if(distMatrix.length<n||distMatrix[0].length<n)throw{error:"Provided distance matrix length "+distMatrix.length+" instead of "+n};i=-1;while(++i<n){dMin[i]=0;j=-1;while(++j<n){if(i===j)distMatrix[i][j]=Infinity;if(distMatrix[i][dMin[i]]>distMatrix[i][j])dMin[i]=j}}}i=-1;while(++i<n){if(i!=id)console.log("i = %d, id = %d",i,id);clusters[i]=[];clusters[i][0]={left:null,right:null,dist:0,centroid:vectors[i],id:id++,size:1,depth:0};cSize[i]=1}for(p=0;p<n-1;p++){c1=0;for(i=0;i<n;i++){if(distMatrix[i][dMin[i]]<distMatrix[c1][dMin[c1]])c1=i}c2=dMin[c1];c1Cluster=clusters[c1][0];c2Cluster=clusters[c2][0];var newCluster={left:c1Cluster,right:c2Cluster,dist:distMatrix[c1][c2],centroid:calculateCentroid(c1Cluster.size,c1Cluster.centroid,c2Cluster.size,c2Cluster.centroid),id:id++,size:c1Cluster.size+c2Cluster.size,depth:1+Math.max(c1Cluster.depth,c2Cluster.depth)};clusters[c1].splice(0,0,newCluster);cSize[c1]+=cSize[c2];for(j=0;j<n;j++){switch(linkage){case"single":if(distMatrix[c1][j]>distMatrix[c2][j])distMatrix[j][c1]=distMatrix[c1][j]=distMatrix[c2][j];break;case"complete":if(distMatrix[c1][j]<distMatrix[c2][j])distMatrix[j][c1]=distMatrix[c1][j]=distMatrix[c2][j];break;case"average":distMatrix[j][c1]=distMatrix[c1][j]=(cSize[c1]*distMatrix[c1][j]+cSize[c2]*distMatrix[c2][j])/(cSize[c1]+cSize[j]);break}}distMatrix[c1][c1]=Infinity;for(i=0;i<n;i++)distMatrix[i][c2]=distMatrix[c2][i]=Infinity;for(j=0;j<n;j++){if(dMin[j]==c2)dMin[j]=c1;if(distMatrix[c1][j]<distMatrix[c1][dMin[c1]])dMin[c1]=j}root=newCluster}return root}hcluster.linkage=function(x){if(!arguments.length)return linkage;linkage=x;return hcluster};hcluster.distance=function(x){if(!arguments.length)return distance;distance=x;return hcluster};hcluster.distanceMatrix=function(x){if(!arguments.length)return distMatrix;distMatrix=x.map(function(y){return y.slice(0)});return hcluster};return hcluster};function calculateCentroid(c1Size,c1Centroid,c2Size,c2Centroid){var newCentroid=[],newSize=c1Size+c2Size,n=c1Centroid.length,i=-1;while(++i<n){newCentroid[i]=(c1Size*c1Centroid[i]+c2Size*c2Centroid[i])/newSize}return newCentroid}reorder.optimal_leaf_order=function(){var distanceMatrix=null,distance=reorder.distance.euclidean,linkage="complete",leavesMap={},orderMap={};function isLeaf(n){return n.depth===0}function leaves(n){if(n===null)return[];if(n.id in leavesMap)return leavesMap[n.id];return leavesMap[n.id]=_leaves(n)}function _leaves(n){if(n===null)return[];if(n.depth===0)return[n.id];return leaves(n.left).concat(leaves(n.right))}function order(v,i,j){var key="k"+v.id+"-"+i+"-"+j;if(key in orderMap)return orderMap[key];return orderMap[key]=_order(v,i,j)}function _order(v,i,j){if(v.depth===0)return[0,[v.id]];var l=v.left,r=v.right;var L=leaves(l),R=leaves(r);var w,x;if(L.indexOf(i)!==-1&&R.indexOf(j)!==-1){w=l;x=r}else if(R.indexOf(i)!==-1&&L.indexOf(j)!==-1){w=r;x=l}else throw{error:"Node is not common ancestor of "+i+", "+j};var Wl=leaves(w.left),Wr=leaves(w.right);var Ks=Wr.indexOf(i)!=-1?Wl:Wr;if(Ks.length===0)Ks=[i];var Xl=leaves(x.left),Xr=leaves(x.right);var Ls=Xr.indexOf(j)!=-1?Xl:Xr;if(Ls.length===0)Ls=[j];var min=Infinity,optimal_order=[];for(var k=0;k<Ks.length;k++){var w_min=order(w,i,Ks[k]);for(var m=0;m<Ls.length;m++){var x_min=order(x,Ls[m],j);var dist=w_min[0]+distanceMatrix[Ks[k]][Ls[m]]+x_min[0];if(dist<min){min=dist;optimal_order=w_min[1].concat(x_min[1])}}}return[min,optimal_order]}function orderFull(v){leavesMap={};orderMap={};var min=Infinity,optimal_order=[],left=leaves(v.left),right=leaves(v.right);if(reorder.debug)console.log(reorder.printhcluster(v,0));for(var i=0;i<left.length;i++){for(var j=0;j<right.length;j++){var so=order(v,left[i],right[j]);if(so[0]<min){min=so[0];optimal_order=so[1]}}}distanceMatrix=null;return optimal_order}function optimal_leaf_order(matrix){if(distanceMatrix===null)distanceMatrix=reorder.dist().distance(distance)(matrix);var hcluster=science.stats.hcluster().linkage(linkage).distanceMatrix(distanceMatrix);return orderFull(hcluster(matrix))}optimal_leaf_order.order=orderFull;optimal_leaf_order.reorder=optimal_leaf_order;optimal_leaf_order.distance=function(x){if(!arguments.length)return distance;distance=x;distanceMatrix=null;return optimal_leaf_order};optimal_leaf_order.linkage=function(x){if(!arguments.length)return linkage;linkage=x;return optimal_leaf_order};optimal_leaf_order.distance_matrix=function(x){if(!arguments.length)return distanceMatrix;distanceMatrix=x.map(function(y){return y.slice(0)});return optimal_leaf_order};optimal_leaf_order.distanceMatrix=optimal_leaf_order.distance_matrix;return optimal_leaf_order};reorder.order=function(){var distance=reorder.distance.euclidean,ordering=reorder.optimal_leaf_order,linkage="complete",distanceMatrix=null,vector,except=[],debug=0,i=0,j=Infinity;function _reset(){distance=reorder.distance.euclidean;ordering=reorder.optimal_leaf_order;linkage="complete";distanceMatrix=null;vector=null;except=[];i=0;j=Infinity}function order(v){vector=v;j=Math.min(j,v.length);var i0=i>0?i-1:0,j0=j<vector.length?j+1:j,k,low,high;for(k=except.length-1;k>0;k-=2){low=except[k-1];high=except[k];if(high>=j0){if(j0>j){j0=Math.min(j0,low+1);except.splice(k-1,2)}else{high=j0}}else if(low<=i0){if(i0<i){i0=Math.max(i0,high-1);except.splice(k-1,2)}else{low=i0}}else if(high-low<3)except.splice(k-1,2)}try{return _order_limits(i0,j0)}finally{_reset()}}function _order_limits(i0,j0){var orig=vector,perm,row,k,l;vector=vector.slice(i0,j0);if(i===0&&j==vector.length)return _order_except();if(reorder.debug)console.log("i0="+i0+" j0="+j0);if(distanceMatrix!==null){if(j0!==vector.length)reorder.dist_remove(distanceMatrix,j0,vector.length);if(i0>0)reorder.dist_remove(distanceMatrix,0,i0)}else{_compute_dist()}var max=reorder.distmax(distanceMatrix);if(i0<i){row=distanceMatrix[0];for(k=row.length;k-->1;)row[k]+=max;for(k=distanceMatrix.length;k-->1;)distanceMatrix[k][0]+=max;max+=max;if(i0!==0){for(k=0;k<except.length;k++)except[k]-=i0}}if(j0>j){l=distanceMatrix.length-1;row=distanceMatrix[l];for(k=l;k-->0;){row[k]+=max;distanceMatrix[k][l]+=max}}perm=_order_except();if(i0<i){if(perm[0]!==0)perm.reverse();if(j0>j){reorder.assert(perm[0]===0&&perm[perm.length-1]==perm.length-1,"Invalid constrained permutation endpoints")}else{reorder.assert(perm[0]===0,"Invalid constrained permutation start")}}else if(j0>j){if(perm[perm.length-1]!==perm.length-1)perm=perm.reverse();reorder.assert(perm[perm.length-1]==perm.length-1,"Invalid constrained permutation end")}if(i0!==0){perm=reorder.permutation(i0).concat(perm.map(function(v){return v+i0}))}if(orig.length>j0){perm=perm.concat(reorder.range(j0,orig.length))}return perm}function _order_except(){var perm,k,l,low,high,pos;if(except.length===0)return _order_equiv();_compute_dist();for(k=except.length-1;k>0;k-=2){low=except[k-1];high=except[k];distanceMatrix=reorder.dist_remove(distanceMatrix,low+1,high-1);vector.splice(low+1,high-low-2);if(reorder.debug)console.log("Except["+low+", "+high+"]");if(distanceMatrix[low][low+1]!==0){distanceMatrix[low][low+1]=distanceMatrix[low+1][low]=-1}}perm=_order_equiv();for(k=0;k<except.length;k+=2){low=except[k];high=except[k+1];for(l=0;l<perm.length;l++){if(perm[l]>low)perm[l]+=high-low-2;else if(perm[l]==low)pos=l}if(pos>0&&perm[pos-1]==high-1){Array.prototype.splice.apply(perm,[pos,0].concat(reorder.range(high-2,low,-1)))}else if(perm[pos+1]==high-1){Array.prototype.splice.apply(perm,[pos+1,0].concat(reorder.range(low+1,high-1)))}else{throw"Range not respected"}}return perm}function _order_equiv(){var perm,row,e,j,k,l,m,n,has_1=false,equiv=[],fix_except={};_compute_dist();for(k=0;k<distanceMatrix.length-1;k++){row=distanceMatrix[k];e=[];j=row.indexOf(-1);if(j!==-1){fix_except[k]=[k,j];has_1=true}for(l=row.length;--l>k;){if(row[l]===0){j=distanceMatrix[l].indexOf(-1);if(j!==-1){fix_except[k]=[l,j];distanceMatrix[j][k]=row[j]=-1;has_1=true}e.unshift(l);distanceMatrix=reorder.dist_remove(distanceMatrix,l);

vector.splice(l,1)}else if(row[l]<0)has_1=true}if(e.length!==0){e.unshift(k);equiv.push(e)}}if(has_1){for(k=0;k<distanceMatrix.length-1;k++){row=distanceMatrix[k];for(l=k+1;l<row.length-1;l++){if(distanceMatrix[l][l+1]==-1){distanceMatrix[l+1][l]=distanceMatrix[l][l+1]=0}}}}perm=_order();for(k=equiv.length;k-->0;){e=equiv[k];l=perm.indexOf(e[0]);m=fix_except[e[0]];if(m&&m[0]==e[0]){l=_fix_exception(perm,l,m[0],m[1],0);m=undefined}for(n=1;n<e.length;n++){perm=_perm_insert(perm,l,e[n]);if(m&&m[0]==e[n]){l=_fix_exception(perm,l,m[0],m[1],n);m=undefined}}}return perm}function _fix_exception(perm,l,m,next,len){var i,j,k;if(l>0&&perm[l-1]==next){_swap(perm,l,perm.indexOf(m));return l+1}else if(perm[l+len+1]==next){_swap(perm,l+len,perm.indexOf(m));return l}else throw"Index not found"}function _swap(perm,a,b){if(a==b)return;var c=perm[a];perm[a]=perm[b];perm[b]=c}function _order(){if(reorder.debug>1)reorder.printmat(distanceMatrix);if(reorder.debug>2)reorder.printmat(vector);var perm=ordering().linkage(linkage).distanceMatrix(distanceMatrix)(vector);if(reorder.debug)console.log("Permutation: "+perm);return perm}function _perm_insert(perm,i,nv){perm=perm.map(function(v){return v<nv?v:v+1});perm.splice(i,0,nv);return perm}function _compute_dist(){if(distanceMatrix===null)distanceMatrix=reorder.dist().distance(distance)(vector);return distanceMatrix}order.distance=function(x){if(!arguments.length)return distance;distance=x;return order};order.linkage=function(x){if(!arguments.length)return linkage;linkage=x;return order};order.limits=function(x,y){if(!arguments.length)return[i,j];i=x;j=y;return order};order.except=function(list){if(!arguments.length)return except.slice(0);except=list.sort(function(a,b){if(a>=b)throw"Invalid list, indices not sorted";return a-b});return order};function _orderExcept(vector,i,j){var distanceMatrix=reorder.dist().distance(distance)(vector);var row,k,l,rev=false,args,pos=-1;distanceMatrix[i][i+1]=0;distanceMatrix[i+1][i]=0;var perm=ordering().distanceMatrix(distanceMatrix)(vector);pos=perm.indexOf(i);for(k=0;k<perm.length;k++){l=perm[k];if(l>i)perm[k]+=j-i-2}if(pos!==0&&perm[pos-1]===j-1)rev=true;if(rev){perm.reverse();pos=perm.length-pos-1}args=[pos+1,0].concat(reorder.range(i+1,j-1));Array.prototype.splice.apply(perm,args);return perm}order.orderrowsexcept=order.orderexcept;return order};reorder.covariance=reorder.dot;reorder.covariancetranspose=function(v,a,b){var n=v.length,cov=0,i;for(i=0;i<n;i++){cov+=v[i][a]*v[i][b]}return cov};reorder.variancecovariance=function(v){var o=v[0].length,cov=Array(o),i,j;for(i=0;i<o;i++){cov[i]=Array(o)}for(i=0;i<o;i++){for(j=i;j<o;j++)cov[i][j]=cov[j][i]=reorder.covariancetranspose(v,i,j)}return cov};reorder.laplacian=function(graph,comp){var n=comp.length,lap=reorder.zeroes(n,n),inv=inverse_permutation(comp),i,j,k,row,sum,edges,v,e,other;reorder.assert(!graph.directed(),"Laplacian only for undirected graphs");for(i=0;i<n;i++){v=comp[i];row=lap[i];sum=0;edges=graph.edges(v);for(j=0;j<edges.length;j++){e=edges[j];other=inv[graph.other(e,v).index];if(other!=i){sum+=e.value;row[other]=-e.value}}row[i]=sum}return lap};function normalize(v){var norm=reorder.length(v),i=v.length;if(norm===0||Math.abs(norm-1)<1e-9)return 1;while(i-->0)v[i]/=norm;return norm}reorder.poweriteration=function(v,eps,init){if(!eps)eps=1e-9;var n=v.length,b,i,j,tmp=Array(n),norm,s=100,e;reorder.assert(n==v[0].length,"poweriteration needs a square matrix");if(!init){b=reorder.random_array(n)}else b=init.slice();normalize(b);while(s-->0){for(i=0;i<n;i++){tmp[i]=0;for(j=0;j<n;j++)tmp[i]+=v[i][j]*b[j]}normalize(tmp);if(reorder.dot(tmp,b)>1-eps)break;var t=tmp;tmp=b;b=t}return tmp};reorder.poweriteration_n=function(v,p,init,eps,start){if(!eps)eps=1e-9;var n=v.length,b=Array(p),i,j,k,l,bk,dot,row,tmp=Array(n),s=100,eigenvalue=Array(p);reorder.assert(n==v[0].length,"poweriteration needs a square matrix");if(!init){for(i=0;i<p;i++){row=b[i]=reorder.random_array(n);eigenvalue[i]=normalize(row)}}else{for(i=0;i<p;i++){b[i]=init[i].slice();eigenvalue[i]=normalize(b[i])}}if(!start)start=0;for(k=start;k<p;k++){bk=b[k];while(s-->0){for(l=0;l<k;l++){row=b[l];dot=reorder.dot(bk,row);for(i=0;i<n;i++)bk[i]-=dot*row[i]}for(i=0;i<n;i++){tmp[i]=0;for(j=0;j<n;j++)tmp[i]+=v[i][j]*bk[j]}eigenvalue[k]=normalize(tmp);if(reorder.dot(tmp,bk)>1-eps)break;bk=tmp;tmp=b[k];b[k]=bk}if(reorder.debug)console.log("eig[%d]=%j",k,bk)}return[b,eigenvalue]};function gershgorin_bound(B){var i,j,max=0,n=B.length,t,row;for(i=0;i<n;i++){row=B[i];t=row[i];for(j=0;j<n;j++)if(j!=i)t+=Math.abs(row[j]);if(t>max)max=t}if(reorder.debug){console.log("gershgorin_bound=%d",max)}return max}function fiedler_vector(B,eps){var g=gershgorin_bound(B),n=B.length,Bhat=B.map(function(row){return row.slice()}),i,j,row;for(i=0;i<n;i++){row=Bhat[i];for(j=0;j<n;j++){if(i==j)row[j]=g-row[j];else row[j]=-row[j]}}var init=[reorder.array1d(n,1),reorder.random_array(n)],eig=reorder.poweriteration_n(Bhat,2,init,eps,1);return eig[0][1]}reorder.fiedler_vector=fiedler_vector;function spectral_order(graph,comps){var i,vec,comp,perm,order=[];if(!comps)comps=graph.components();for(i=0;i<comps.length;i++){comp=comps[i];vec=reorder.fiedler_vector(reorder.laplacian(graph,comp));perm=reorder.sort_order(vec);order=order.concat(reorder.permute(comp,perm))}return order}reorder.spectral_order=spectral_order;function center(v){var n=v.length;if(n===0)return null;var mean=reorder.meancolumns(v),o=mean.length,v1=Array(n),i,j,row;for(i=0;i<n;i++){row=v[i].slice(0);for(j=0;j<o;j++){row[j]-=mean[j]}v1[i]=row}return v1}reorder.pca1d=function(v,eps){var n=v.length;if(v.length===0)return null;v=center(v);var cov=reorder.variancecovariance(v);return reorder.poweriteration(cov,eps)};reorder.pca_order=function(v,eps){return reorder.sort_order(pca1d(v,eps))};function sumrows(v){var n=v.length,o=v[0].length,sumrow=Array(n),i,j,row,s;for(i=0;i<n;i++){row=v[i];s=0;for(j=0;j<o;j++)s+=row[j];sumrow[i]=s}return sumrow}function sumcols(v){var n=v.length,o=v[0].length,sumcol=reorder.zeroes(o),i,j,row;for(i=0;i<n;i++){row=v[i];for(j=0;j<o;j++)sumcol[j]+=row[j]}return sumcol}function decorana(dat){var ZEROEIG=1e-7,x,y,aidot,adotj,mi,n,s1,nr=dat.length,nc=dat[0].length;adotj=sumcols(dat);aidot=sumrows(dat);s1=eigy(reorder.array1d(nr,1),reorder.array1d(nc,1),nr,nc,dat,aidot,adotj);if(s1.eig<ZEROEIG){s1.rows=s1.cols=[];s1.eig=0}else{x=s1.rows;y=s1.cols;yxmult(y,x,nr,nc,dat);for(var i=0;i<nr;i++)x[i]/=aidot[i]}return s1}function trans(y,yy,x,aidot,mi,n,dat,prt){var i,j,a1;if(prt)console.log("TRANS "+prt);yxmult(y,x,mi,n,dat,prt);for(i=0;i<mi;i++){x[i]=x[i]/aidot[i]}xymult(x,yy,mi,n,dat,prt)}function printvec(y){console.log("");for(var i=0;i<y.length;i++){console.log("i:"+(i+1)+" v:  "+y[i].toFixed(5))}}function xymult(x,y,mi,n,dat,prt){var i,j,ax,row;if(prt){console.log("xymult");printvec(y,5,null,"y=")}for(j=0;j<n;j++)y[j]=0;for(i=0;i<mi;i++){ax=x[i];row=dat[i];for(j=0;j<n;j++)y[j]+=ax*row[j]}if(prt){printvec(y,5,null,"y=")}}function yxmult(y,x,mi,n,dat,prt){var i,j,ax,row;if(prt){console.log("yxmult");printvec(x,5,null,"x=")}for(i=0;i<mi;i++){ax=0;row=dat[i];for(j=0;j<n;j++){ax+=y[j]*row[j]}x[i]=ax}if(prt){printvec(x,5,null,"x=")}}function eigy(x,y,mi,n,dat,aidot,adotj){var i,j,tot,icount,a,ay,ex,a11,a12,a22,a23,a33,a34,a44,res,ax1,ax2,ax3,ax4,b13,b14,b24,row,y2=reorder.zeroes(n),y3=reorder.zeroes(n),y4=reorder.zeroes(n),y5=reorder.zeroes(n),tol;tot=0;for(j=0;j<n;j++){tot+=adotj[j];y[j]=j+1}y[0]=1.1;tol=5e-6;trans(y,y,x,aidot,mi,n,dat);icount=0;while(true){a=0;for(j=0;j<n;j++)a+=y[j]*adotj[j];a/=tot;ex=0;for(j=0;j<n;j++){ay=y[j]-a;ex+=ay*ay*adotj[j];y[j]=ay}ex=Math.sqrt(ex);for(j=0;j<n;j++)y[j]/=ex;trans(y,y2,x,aidot,mi,n,dat);a=0;a11=0;a12=0;a22=0;a23=0;a33=0;a34=0;a44=0;for(j=0;j<n;j++){ay=y2[j];y2[j]=ay/adotj[j];a+=ay;a11+=ay*y[j]}a/=tot;for(j=0;j<n;j++){ay=y2[j]-(a+a11*y[j]);a12+=ay*ay*adotj[j];y2[j]=ay}a12=Math.sqrt(a12);for(j=0;j<n;j++)y2[j]/=a12;if(a12<tol||icount>999)break;icount++;trans(y2,y3,x,aidot,mi,n,dat);a=0;b13=0;for(j=0;j<n;j++){ay=y3[j];y3[j]=ay/adotj[j];a+=ay;a22+=ay*y2[j];b13+=ay*y[j]}a/=tot;for(j=0;j<n;j++){ay=y3[j]-(a+a22*y2[j]+b13*y[j]);a23+=ay*ay*adotj[j];y3[j]=ay}a23=Math.sqrt(a23);if(a23>tol){for(j=0;j<n;j++){y3[j]/=a23}trans(y3,y4,x,aidot,mi,n,dat);a=0;b14=0;b24=0;for(j=0;j<n;j++){ay=y4[j];y4[j]/=adotj[j];a+=ay;a33+=ay*y3[j];b14+=ay*y[j];b24+=ay*y2[j]}a/=tot;for(j=0;j<n;j++){ay=y4[j]-(a+a33*y3[j]+b14*y[j]+b24*y2[j]);a34+=ay*ay*adotj[j];y4[j]=ay}a34=Math.sqrt(a34);if(a34>tol){for(j=0;j<n;j++)y4[j]/=a34;trans(y4,y5,x,aidot,mi,n,dat);for(j=0;j<n;j++)a44+=y4[j]*y5[j]}else{a34=0}}else{a23=0}res=solve_tridiag(tol,a11,a12,a22,a23,a33,a34,a44);ax1=res[0];ax2=res[1];ax3=res[2];ax4=res[3];if(a12<tol)break;for(j=0;j<n;j++)y[j]=ax1*y[j]+ax2*y2[j]+ax3*y3[j]+ax4*y4[j]}if(a12>tol&&reorder.debug>0){console.log("residual bigger than tolerance on axis 1")}var aymax=y[0],aymin=y[0],sign=1;for(j=1;j<n;j++){a=y[j];if(a<aymin)aymin=a;else if(a>aymax)aymax=a}if(-aymin>aymax){for(j=0;j<n;j++)y[j]=-y[j]}yxmult(y,x,mi,n,dat);for(i=0;i<mi;i++)x[i]/=aidot[i];var axlong=0;for(i=0;i<mi;i++)axlong+=aidot[i]*sqr(x[i]);axlong=Math.sqrt(axlong);for(i=0;i<mi;i++)x[i]/=axlong;for(j=0;j<n;j++)y[j]/=axlong;var sumsq=0,ax;for(i=0;i<mi;i++){ax=x[i];row=dat[i];for(j=0;j<n;j++){sumsq+=row[j]*sqr(ax-y[j])}}var sd=Math.sqrt(sumsq/tot);if(a11>=.999){sd=aymax/axlong;var sd1=-aymin/axlong;if(sd1>sd)sd=sd1}for(j=0;j<n;j++)y[j]/=sd;return{rows:x,cols:y,eig:a11}}function sqr(x){return x*x}function solve_tridiag(tol,a11,a12,a22,a23,a33,a34,a44){var ax1=1,ax2=.1,ax3=.01,ax4=.001,itimes,axx1,axx2,axx3,axx4,ex,exx,resi;for(itimes=0;itimes<100;itimes++){axx1=a11*ax1+a12*ax2;axx2=a12*ax1+a22*ax2+a23*ax3;axx3=a23*ax2+a33*ax3+a34*ax4;axx4=a34*ax3+a44*ax4;ax1=a11*axx1+a12*axx2;ax2=a12*axx1+a22*axx2+a23*axx3;ax3=a23*axx2+a33*axx3+a34*axx4;ax4=a34*axx3+a44*axx4;ex=Math.sqrt(sqr(ax1)+sqr(ax2)+sqr(ax3)+sqr(ax4));ax1=ax1/ex;ax2=ax2/ex;ax3=ax3/ex;ax4=ax4/ex;if((itimes+1)%5===0){exx=Math.sqrt(ex);resi=Math.sqrt(sqr(ax1-axx1/exx)+sqr(ax2-axx2/exx)+sqr(ax3-axx3/exx)+sqr(ax4-axx4/exx))}if(resi<tol*.05)break}return[ax1,ax2,ax3,ax4]}reorder.ca_decorana=decorana;reorder.ca=decorana;reorder.ca_order=function(dat){var res=reorder.ca(dat);return{rows:reorder.sort_order(res.rows),cols:reorder.sort_order(res.cols),details:res}};reorder.cuthill_mckee=function(graph,comp){if(comp.length<3)return comp;var nodes=graph.nodes(),start=comp[0],min_deg=graph.degree(start),i,n,edges,e,visited={},queue=new Queue,inv=inverse_permutation(comp),perm=[];for(i=0;i<comp.length;i++){n=comp[i];if(graph.degree(n)<min_deg){min_deg=graph.degree(n);start=n;if(min_deg==1)break}}queue.push(start);while(queue.length!==0){n=queue.shift();if(visited[n])continue;visited[n]=true;perm.push(n);e=graph.edges(n).map(function(edge){return graph.other(edge,n).index}).filter(function(n){return!visited[n]&&n in inv}).sort(function(a,b){return graph.degree(a)-graph.degree(b)});e.forEach(queue.push,queue)}return perm};reorder.reverse_cuthill_mckee=function(graph,comp){return reorder.cuthill_mckee(graph,comp).reverse()};reorder.cuthill_mckee_order=function(graph,comps){var i,comp,order=[];if(!comps){comps=graph.components()}for(i=0;i<comps.length;i++){comp=comps[i];order=order.concat(reorder.cuthill_mckee(graph,comp))}return order};reorder.reverse_cuthill_mckee_order=function(graph,comps){var i,comp,order=[];if(!comps){comps=graph.components()}for(i=0;i<comps.length;i++){comp=comps[i];order=order.concat(reorder.reverse_cuthill_mckee(graph,comp))}return order};reorder.condition=function(matrix){var i,j,min,max,v,s,row,ret=[];for(i=0;0<matrix.length;i++){row=matrix[i].slice();row.push(ret);for(j=0;j<ret.length;j++){v=row[j];if(v!==null&&b>=b){min=max=row[j];break}}for(;j<ret.length;j++){v=row[j];if(v<min)min=v;else if(v>max)max=v}s=max!=min?1/(max-min):0;for(j=1;j<ret.length;j++){v=row[j];if(v!==null&&v>=v)row[j]=row[j]*s-min;else v=NaN}}return ret};function array_to_dicts(data,axes){if(arguments.length<2)axes=reorder.range(data[0].length);var ret=[],row,dict,i,j;for(i=0;i<data.length;i++){row=data[i];dict={};for(j=0;j<row.length;j++){dict[axes[j]]=row[j]}ret.push(dict)}return ret}reorder.array_to_dicts=array_to_dicts;function dicts_to_array(dicts,keys){if(arguments.length<2)keys=Object.keys(dicts[0]);var n=keys.length,m=dicts.length,array=Array(m),i,j,row;for(i=0;i<m;i++){row=Array(n);array[i]=row;for(j=0;j<n;j++)row[j]=dicts[i][keys[j]]}return array}reorder.dicts_to_array=dicts_to_array;function abs_matrix(x){return x.map(function(y){return y.map(Math.abs)})}function pcp_flip_axes(perm,naxes,pcor){var i,c,sign=1,signs=[1],negs=0;for(i=1;i<perm.length;i++){c=pcor[perm[i-1]][perm[i]];if(c<0)sign=-sign;if(sign<0){signs.push(-1);negs++}else signs.push(1)}if(reorder.debug)console.log(signs);sign=negs>perm.length-negs?-1:1;if(sign==-1){for(i=0;i<perm.length-1;i++)signs[i]=signs[i]*sign}return signs}function pcp(data,axes){if(!axes)axes=reorder.range(data[0].length);var tdata=reorder.transpose(data),pcor=reorder.correlation.pearsonMatrix(tdata),abs_pcor=abs_matrix(pcor),h1=science.stats.hcluster().linkage("complete").distanceMatrix(abs_pcor)(tdata),perm=reorder.optimal_leaf_order().distanceMatrix(abs_pcor)(tdata),naxes=reorder.permute(axes,perm);tdata=reorder.permute(tdata,perm);var signs=pcp_flip_axes(perm,naxes,pcor),ndata=reorder.transpose(tdata);return[ndata,perm,naxes,signs,pcor]}reorder.pcp=pcp;function parcoords(p){p.detectDimensions().autoscale();var data=p.data(),types=p.types(),dimensions=p.dimensions(),tdata=[],row,discarded=[],i,j,k,d;for(i=0;i<dimensions.length;i++){d=dimensions[i];if(types[d]=="number"){row=[];for(j=0;j<data.length;j++)row.push(data[j][d]);tdata.push(row)}else if(types[d]=="date"){row=[];for(j=0;j<data.length;j++)row.push(data[j][d].getTime()*.001);tdata.push(row)}else{dimensions.splice(i,1);discarded.push(d);i--}}var pcor=reorder.correlation.pearsonMatrix(tdata),abs_pcor=abs_matrix(pcor),h1=science.stats.hcluster().linkage("complete").distanceMatrix(abs_pcor)(tdata),perm=reorder.optimal_leaf_order().distanceMatrix(abs_pcor)(tdata),naxes=reorder.permute(dimensions,perm);tdata=reorder.permute(tdata,perm);var signs=pcp_flip_axes(perm,naxes,pcor);for(i=0;i<signs.length;i++){if(signs[i]<0)p.flip(dimensions[i])}dimensions=discarded.reverse().concat(dimensions);return p.dimensions(dimensions)}reorder.parcoords=parcoords})(this);
